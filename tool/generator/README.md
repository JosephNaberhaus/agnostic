# Generator

This package contains a tool used to generate the [ast](../../ast) and [code](../../code) packages.

- AST nodes are the bare-bones repersentation of Agnostic code.
    - They can be instantiated manually when using Agnostic as a Golang library.
    - Or they can be generated by writing AgnosticScript.
- Code nodes are a compiled version of a valid AST.
    - They should never be instantiated manually.
    - They contain metadata about the node that the language-specific generators can use.
    - Their properties are all pointers because the metadata properties often create reference loops.

It also generates the mappers for each package. Mappers are basically just a wrapper around a type switch. The main difference is that mappers force you to be exhaustive. If you add a new node you will get a compile time error until you handle the new node.

## Updating the AST

To add something to the AST and Code nodes you will make an update to the [spec](./spec). When you're finished, just run `just gen` at the root of this repo.

If you're adding a new node you will need to add a corresponding metadata struct to [metadata.go](../../code/metadata.go). This can be empty to start with. Add properties to this on an as-needed basis for the language generators.

### Spec Format

Each yaml file in the [spec](./spec) corresponds to a single node specification. You cannot combine multiple specs into one file. The format of each file is simple:

```yaml
# The name of the node. The generated struct will use the exact same name.
name: Example
# A list of types that this node should implement. This will include this node in the mapper for each type.
types:
    - Type1
    - Type2
# Key-value pairs for each property of this spec.
properties:
    # A primitive key value pair. This can be any valid Golang primitive.
    key1: string
    # The value can be the name of another node in the spec.
    key2: AnotherNode
    # Or it can be the name of any type in the spec prefixed by a tilde.
    key3: ~Type
    # Brackets notate a list. Note that you need to wrap this string in quotations to prevent YAML from misparsing it.
    key2: "[]int64"
    # Optional is used for something that might not be present.
    # This will be removed when generating code nodes since the use of pointers make them unnecessary.
    key3: Optional[value3]
```
